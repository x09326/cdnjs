"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function findWhereUnwrapped(t,e){return t.flatMap(function(t){return(0,_MountedTraversal.treeFilter)(t.node,e)})}function filterWhereUnwrapped(t,e){return t.wrap((0,_compact2["default"])(t.nodes.filter(e)))}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_cheerio=require("cheerio"),_cheerio2=_interopRequireDefault(_cheerio),_flatten=require("lodash/flatten"),_flatten2=_interopRequireDefault(_flatten),_uniq=require("lodash/uniq"),_uniq2=_interopRequireDefault(_uniq),_compact=require("lodash/compact"),_compact2=_interopRequireDefault(_compact),_ReactWrapperComponent=require("./ReactWrapperComponent"),_ReactWrapperComponent2=_interopRequireDefault(_ReactWrapperComponent),_MountedTraversal=require("./MountedTraversal"),_reactCompat=require("./react-compat"),_Utils=require("./Utils"),_Debug=require("./Debug"),ReactWrapper=function(){function t(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(_classCallCheck(this,t),!global.window&&!global.document)throw new Error("It looks like you called `mount()` without a global document being loaded.");if(n)this.component=null,this.root=n,Array.isArray(e)?(this.node=e[0],this.nodes=e):(this.node=e,this.nodes=[e]),this.length=this.nodes.length;else{var o=(0,_ReactWrapperComponent2["default"])(e,r);this.component=(0,_reactCompat.renderWithOptions)(_react2["default"].createElement(o,{Component:e.type,props:e.props,context:r.context}),r),this.root=this,this.node=this.component.getWrappedComponent(),this.nodes=[this.node],this.length=1}this.options=r}return _createClass(t,[{key:"ref",value:function(){function t(t){if(this.root!==this)throw new Error("ReactWrapper::ref(refname) can only be called on the root");return this.wrap(this.instance().refs[t])}return t}()},{key:"instance",value:function(){function t(){if(this.root!==this)throw new Error("ReactWrapper::instance() can only be called on the root");return this.component.getInstance()}return t}()},{key:"update",value:function(){function t(){var t=this;if(this.root!==this)throw new Error("ReactWrapper::update() can only be called on the root");return this.single(function(){t.component.forceUpdate()}),this}return t}()},{key:"unmount",value:function(){function t(){var t=this;if(this.root!==this)throw new Error("ReactWrapper::unmount() can only be called on the root");return this.single(function(){t.component.setState({mount:!1})}),this}return t}()},{key:"mount",value:function(){function t(){var t=this;if(this.root!==this)throw new Error("ReactWrapper::mount() can only be called on the root");return this.single(function(){t.component.setState({mount:!0})}),this}return t}()},{key:"setProps",value:function(){function t(t){if(this.root!==this)throw new Error("ReactWrapper::setProps() can only be called on the root");return this.component.setChildProps(t),this}return t}()},{key:"setState",value:function(){function t(t){if(this.root!==this)throw new Error("ReactWrapper::setState() can only be called on the root");return this.instance().setState(t),this}return t}()},{key:"setContext",value:function(){function t(t){if(this.root!==this)throw new Error("ReactWrapper::setContext() can only be called on the root");if(!this.options.context)throw new Error("ShallowWrapper::setContext() can only be called on a wrapper that was originally passed a context option");return this.component.setChildContext(t),this}return t}()},{key:"contains",value:function(){function t(t){var e=Array.isArray(t)?function(e){return(0,_Utils.containsChildrenSubArray)(_MountedTraversal.instEqual,e,t)}:function(e){return(0,_MountedTraversal.instEqual)(t,e)};return findWhereUnwrapped(this,e).length>0}return t}()},{key:"find",value:function(){function t(t){var e=(0,_MountedTraversal.buildInstPredicate)(t);return findWhereUnwrapped(this,e)}return t}()},{key:"is",value:function(){function t(t){var e=(0,_MountedTraversal.buildInstPredicate)(t);return this.single(function(t){return e(t)})}return t}()},{key:"filterWhere",value:function(){function t(t){var e=this;return filterWhereUnwrapped(this,function(n){return t(e.wrap(n))})}return t}()},{key:"filter",value:function(){function t(t){var e=(0,_MountedTraversal.buildInstPredicate)(t);return filterWhereUnwrapped(this,e)}return t}()},{key:"not",value:function(){function t(t){var e=(0,_MountedTraversal.buildInstPredicate)(t);return filterWhereUnwrapped(this,function(t){return!e(t)})}return t}()},{key:"text",value:function(){function t(){return this.single(function(t){return(0,_reactCompat.findDOMNode)(t).textContent})}return t}()},{key:"html",value:function(){function t(){return this.single(function(t){var e=(0,_reactCompat.findDOMNode)(t);return null===e?null:e.outerHTML.replace(/\sdata-(reactid|reactroot)+="([^"]*)+"/g,"")})}return t}()},{key:"render",value:function(){function t(){var t=this.html();return null===t?(0,_cheerio2["default"])():_cheerio2["default"].load(t).root()}return t}()},{key:"simulate",value:function(){function t(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return this.single(function(e){var r=(0,_Utils.mapNativeEventNames)(t),o=_reactCompat.Simulate[r];if(!o)throw new TypeError("ReactWrapper::simulate() event '"+String(t)+"' does not exist");o.apply(void 0,[(0,_reactCompat.findDOMNode)(e)].concat(n))}),this}return t}()},{key:"props",value:function(){function t(){return this.single(_Utils.propsOfNode)}return t}()},{key:"state",value:function(){function t(t){var e=this;if(this.root!==this)throw new Error("ReactWrapper::state() can only be called on the root");var n=this.single(function(){return e.instance().state});return void 0!==t?n[t]:n}return t}()},{key:"context",value:function(){function t(t){var e=this;if(this.root!==this)throw new Error("ReactWrapper::context() can only be called on the root");var n=this.single(function(){return e.instance().context});return void 0!==t?n[t]:n}return t}()},{key:"children",value:function(){function t(t){var e=this.flatMap(function(t){return(0,_MountedTraversal.childrenOfInst)(t.node)});return t?e.filter(t):e}return t}()},{key:"childAt",value:function(){function t(t){var e=this;return this.single(function(){return e.children().at(t)})}return t}()},{key:"parents",value:function(){function t(t){var e=this,n=this.wrap(this.single(function(t){return(0,_MountedTraversal.parentsOfInst)(t,e.root.node)}));return t?n.filter(t):n}return t}()},{key:"parent",value:function(){function t(){return this.flatMap(function(t){return[t.parents().get(0)]})}return t}()},{key:"closest",value:function(){function t(t){return this.is(t)?this:this.parents().filter(t).first()}return t}()},{key:"prop",value:function(){function t(t){return this.props()[t]}return t}()},{key:"type",value:function(){function t(){return this.single(function(t){return(0,_Utils.typeOfNode)((0,_MountedTraversal.getNode)(t))})}return t}()},{key:"hasClass",value:function(){function t(t){return t&&-1!==t.indexOf(".")&&console.log("It looks like you're calling `ReactWrapper::hasClass()` with a CSS selector. hasClass() expects a class name, not a CSS selector."),this.single(function(e){return(0,_MountedTraversal.instHasClassName)(e,t)})}return t}()},{key:"forEach",value:function(){function t(t){var e=this;return this.nodes.forEach(function(n,r){return t.call(e,e.wrap(n),r)}),this}return t}()},{key:"map",value:function(){function t(t){var e=this;return this.nodes.map(function(n,r){return t.call(e,e.wrap(n),r)})}return t}()},{key:"reduce",value:function(){function t(t,e){var n=this;return this.nodes.reduce(function(e,r,o){return t.call(n,e,n.wrap(r),o)},e)}return t}()},{key:"reduceRight",value:function(){function t(t,e){var n=this;return this.nodes.reduceRight(function(e,r,o){return t.call(n,e,n.wrap(r),o)},e)}return t}()},{key:"some",value:function(){function t(t){var e=(0,_MountedTraversal.buildInstPredicate)(t);return this.nodes.some(e)}return t}()},{key:"someWhere",value:function(){function t(t){var e=this;return this.nodes.some(function(n,r){return t.call(e,e.wrap(n),r)})}return t}()},{key:"every",value:function(){function t(t){var e=(0,_MountedTraversal.buildInstPredicate)(t);return this.nodes.every(e)}return t}()},{key:"everyWhere",value:function(){function t(t){var e=this;return this.nodes.every(function(n,r){return t.call(e,e.wrap(n),r)})}return t}()},{key:"flatMap",value:function(){function t(t){var e=this,n=this.nodes.map(function(n,r){return t.call(e,e.wrap(n),r)}),r=(0,_flatten2["default"])(n,!0),o=(0,_uniq2["default"])(r);return this.wrap(o)}return t}()},{key:"findWhere",value:function(){function t(t){var e=this;return findWhereUnwrapped(this,function(n){return t(e.wrap(n))})}return t}()},{key:"get",value:function(){function t(t){return this.nodes[t]}return t}()},{key:"at",value:function(){function t(t){return this.wrap(this.nodes[t])}return t}()},{key:"first",value:function(){function t(){return this.at(0)}return t}()},{key:"last",value:function(){function t(){return this.at(this.length-1)}return t}()},{key:"isEmpty",value:function(){function t(){return 0===this.length}return t}()},{key:"single",value:function(){function t(t){if(1!==this.length)throw new Error("This method is only meant to be run on single node. "+String(this.length)+" found instead.");return t.call(this,this.node)}return t}()},{key:"wrap",value:function(){function e(e){return e instanceof t?e:new t(e,this.root)}return e}()},{key:"debug",value:function(){function t(){return(0,_Debug.debugInsts)(this.nodes)}return t}()},{key:"detach",value:function(){function t(){if(this.root!==this)throw new Error("ReactWrapper::detach() can only be called on the root");if(!this.options.attachTo)throw new Error("ReactWrapper::detach() can only be called on when the `attachTo` option was passed into `mount()`.");(0,_reactCompat.unmountComponentAtNode)(this.options.attachTo)}return t}()}]),t}();exports["default"]=ReactWrapper;
//# sourceMappingURL=./ReactWrapper.min.js.map