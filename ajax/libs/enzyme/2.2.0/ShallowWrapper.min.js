"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function findWhereUnwrapped(e,t){return e.flatMap(function(e){return(0,_ShallowTraversal.treeFilter)(e.node,t)})}function filterWhereUnwrapped(e,t){return e.wrap((0,_compact2["default"])(e.nodes.filter(t)))}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_flatten=require("lodash/flatten"),_flatten2=_interopRequireDefault(_flatten),_uniq=require("lodash/uniq"),_uniq2=_interopRequireDefault(_uniq),_compact=require("lodash/compact"),_compact2=_interopRequireDefault(_compact),_cheerio=require("cheerio"),_cheerio2=_interopRequireDefault(_cheerio),_Utils=require("./Utils"),_Debug=require("./Debug"),_ShallowTraversal=require("./ShallowTraversal"),_reactCompat=require("./react-compat"),ShallowWrapper=function(){function e(t,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];_classCallCheck(this,e),n?(this.root=n,this.unrendered=null,this.renderer=null,Array.isArray(t)?(this.node=t[0],this.nodes=t):(this.node=t,this.nodes=[t]),this.length=this.nodes.length):(this.root=this,this.unrendered=t,this.renderer=(0,_reactCompat.createShallowRenderer)(),this.renderer.render(t,r.context),this.node=this.renderer.getRenderOutput(),this.nodes=[this.node],this.length=1),this.options=r}return _createClass(e,[{key:"instance",value:function(){function e(){return this.renderer._instance._instance}return e}()},{key:"update",value:function(){function e(){var e=this;if(this.root!==this)throw new Error("ShallowWrapper::update() can only be called on the root");return this.single(function(){e.node=e.renderer.getRenderOutput(),e.nodes=[e.node]}),this}return e}()},{key:"setProps",value:function(){function e(e){var t=this;if(this.root!==this)throw new Error("ShallowWrapper::setProps() can only be called on the root");return this.single(function(){(0,_Utils.withSetStateAllowed)(function(){t.unrendered=_react2["default"].cloneElement(t.unrendered,e),t.renderer.render(t.unrendered,t.options.context),t.update()})}),this}return e}()},{key:"setState",value:function(){function e(e){var t=this;if(this.root!==this)throw new Error("ShallowWrapper::setState() can only be called on the root");return this.single(function(){(0,_Utils.withSetStateAllowed)(function(){t.instance().setState(e),t.update()})}),this}return e}()},{key:"setContext",value:function(){function e(e){if(this.root!==this)throw new Error("ShallowWrapper::setContext() can only be called on the root");if(!this.options.context)throw new Error("ShallowWrapper::setContext() can only be called on a wrapper that was originally passed a context option");return this.renderer.render(this.unrendered,e),this.update(),this}return e}()},{key:"contains",value:function(){function e(e){var t=Array.isArray(e)?function(t){return(0,_Utils.containsChildrenSubArray)(_Utils.nodeEqual,t,e)}:function(t){return(0,_Utils.nodeEqual)(e,t)};return findWhereUnwrapped(this,t).length>0}return e}()},{key:"equals",value:function(){function e(e){var t=this;return this.single(function(){return(0,_Utils.nodeEqual)(t.node,e)})}return e}()},{key:"find",value:function(){function e(e){var t=(0,_ShallowTraversal.buildPredicate)(e);return findWhereUnwrapped(this,t)}return e}()},{key:"is",value:function(){function e(e){var t=(0,_ShallowTraversal.buildPredicate)(e);return this.single(t)}return e}()},{key:"filterWhere",value:function(){function e(e){var t=this;return filterWhereUnwrapped(this,function(n){return e(t.wrap(n))})}return e}()},{key:"filter",value:function(){function e(e){var t=(0,_ShallowTraversal.buildPredicate)(e);return filterWhereUnwrapped(this,t)}return e}()},{key:"not",value:function(){function e(e){var t=(0,_ShallowTraversal.buildPredicate)(e);return filterWhereUnwrapped(this,function(e){return!t(e)})}return e}()},{key:"text",value:function(){function e(){return this.single(_ShallowTraversal.getTextFromNode)}return e}()},{key:"html",value:function(){function e(){var e=this;return this.single(function(t){return null===e.type()?null:(0,_reactCompat.renderToStaticMarkup)(t)})}return e}()},{key:"render",value:function(){function e(){return null===this.type()?(0,_cheerio2["default"])():_cheerio2["default"].load(this.html()).root()}return e}()},{key:"unmount",value:function(){function e(){return this.renderer.unmount(),this}return e}()},{key:"simulate",value:function(){function e(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var u=this.prop((0,_Utils.propFromEvent)(e));return u&&(0,_Utils.withSetStateAllowed)(function(){u.apply(void 0,r),t.root.update()}),this}return e}()},{key:"props",value:function(){function e(){return this.single(_Utils.propsOfNode)}return e}()},{key:"state",value:function(){function e(e){var t=this;if(this.root!==this)throw new Error("ShallowWrapper::state() can only be called on the root");var n=this.single(function(){return t.instance().state});return void 0!==e?n[e]:n}return e}()},{key:"context",value:function(){function e(e){var t=this;if(this.root!==this)throw new Error("ShallowWrapper::context() can only be called on the root");var n=this.single(function(){return t.instance().context});return e?n[e]:n}return e}()},{key:"children",value:function(){function e(e){var t=this.flatMap(function(e){return(0,_ShallowTraversal.childrenOfNode)(e.node)});return e?t.filter(e):t}return e}()},{key:"childAt",value:function(){function e(e){var t=this;return this.single(function(){return t.children().at(e)})}return e}()},{key:"parents",value:function(){function e(e){var t=this,n=this.wrap(this.single(function(e){return(0,_ShallowTraversal.parentsOfNode)(e,t.root.node)}));return e?n.filter(e):n}return e}()},{key:"parent",value:function(){function e(){return this.flatMap(function(e){return[e.parents().get(0)]})}return e}()},{key:"closest",value:function(){function e(e){return this.is(e)?this:this.parents().filter(e).first()}return e}()},{key:"shallow",value:function(){function t(t){return this.single(function(n){return new e(n,null,t)})}return t}()},{key:"prop",value:function(){function e(e){return this.props()[e]}return e}()},{key:"type",value:function(){function e(){return this.single(_Utils.typeOfNode)}return e}()},{key:"hasClass",value:function(){function e(e){return e&&-1!==e.indexOf(".")&&console.warn("It looks like you're calling `ShallowWrapper::hasClass()` with a CSS selector. hasClass() expects a class name, not a CSS selector."),this.single(function(t){return(0,_ShallowTraversal.hasClassName)(t,e)})}return e}()},{key:"forEach",value:function(){function e(e){var t=this;return this.nodes.forEach(function(n,r){return e.call(t,t.wrap(n),r)}),this}return e}()},{key:"map",value:function(){function e(e){var t=this;return this.nodes.map(function(n,r){return e.call(t,t.wrap(n),r)})}return e}()},{key:"reduce",value:function(){function e(e,t){var n=this;return this.nodes.reduce(function(t,r,i){return e.call(n,t,n.wrap(r),i)},t)}return e}()},{key:"reduceRight",value:function(){function e(e,t){var n=this;return this.nodes.reduceRight(function(t,r,i){return e.call(n,t,n.wrap(r),i)},t)}return e}()},{key:"some",value:function(){function e(e){var t=(0,_ShallowTraversal.buildPredicate)(e);return this.nodes.some(t)}return e}()},{key:"someWhere",value:function(){function e(e){var t=this;return this.nodes.some(function(n,r){return e.call(t,t.wrap(n),r)})}return e}()},{key:"every",value:function(){function e(e){var t=(0,_ShallowTraversal.buildPredicate)(e);return this.nodes.every(t)}return e}()},{key:"everyWhere",value:function(){function e(e){var t=this;return this.nodes.every(function(n,r){return e.call(t,t.wrap(n),r)})}return e}()},{key:"flatMap",value:function(){function e(e){var t=this,n=this.nodes.map(function(n,r){return e.call(t,t.wrap(n),r)}),r=(0,_flatten2["default"])(n,!0),i=(0,_uniq2["default"])(r);return this.wrap(i)}return e}()},{key:"findWhere",value:function(){function e(e){var t=this;return findWhereUnwrapped(this,function(n){return e(t.wrap(n))})}return e}()},{key:"get",value:function(){function e(e){return this.nodes[e]}return e}()},{key:"at",value:function(){function e(e){return this.wrap(this.nodes[e])}return e}()},{key:"first",value:function(){function e(){return this.at(0)}return e}()},{key:"last",value:function(){function e(){return this.at(this.length-1)}return e}()},{key:"isEmpty",value:function(){function e(){return 0===this.length}return e}()},{key:"single",value:function(){function e(e){if(1!==this.length)throw new Error("This method is only meant to be run on single node. "+String(this.length)+" found instead.");return e.call(this,this.node)}return e}()},{key:"wrap",value:function(){function t(t){return t instanceof e?t:new e(t,this.root)}return t}()},{key:"debug",value:function(){function e(){return(0,_Debug.debugNodes)(this.nodes)}return e}()}]),e}();exports["default"]=ShallowWrapper;
//# sourceMappingURL=./ShallowWrapper.min.js.map